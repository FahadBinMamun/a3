<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ü‡¶Æ‡¶æ‡¶∞ Doraemon-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Hind Siliguri', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #FFE5E5 0%, #FFC7C7 100%);
        }
        .card {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .pin-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        textarea {
            word-break: break-all;
        }
    </style>
</head>
<body class="gradient-bg text-gray-800">

    <!-- PIN Screen -->
    <div id="pin-screen" class="pin-container">
        <div class="card p-8 rounded-2xl shadow-xl text-center max-w-sm mx-auto">
            <h2 class="text-2xl font-bold mb-4 text-gray-700">Hi Doraemon <br>‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã...</h2>
            <p class="text-gray-600 mb-6">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡¶ø‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßã</p>
            <input type="password" id="pin-input" class="w-full p-3 border border-gray-300 rounded-lg text-center text-lg tracking-widest focus:ring-2 focus:ring-rose-400 focus:border-transparent" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button id="enter-btn" class="mt-6 w-full bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300 shadow-md">‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶è‡¶∏‡ßã</button>
            <p id="pin-error" class="text-red-500 mt-4 text-sm h-4"></p>
        </div>
    </div>

    <!-- Main Content (Hidden by default) -->
    <div id="main-content" class="hidden">
        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <!-- User View -->
            <div id="user-view" class="hidden space-y-8">
                <header class="text-center">
                    <h1 class="text-3xl md:text-4xl font-bold text-rose-600">‡¶Ü‡¶Æ‡¶æ‡¶∞ Ananna-‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</h1>
                    <p class="text-lg md:text-xl text-gray-700 mt-2">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ì‡¶á ‡¶Æ‡¶ø‡¶∑‡ßç‡¶ü‡¶ø ‡¶†‡ßã‡¶Å‡¶ü ‡¶¶‡ßÅ‡¶ü‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</p>
                </header>
                
                <section id="challenge-section" class="card p-6 rounded-2xl shadow-lg text-center">
                    <div id="start-state" class="hidden">
                        <h2 class="text-2xl font-semibold mb-4">‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú‡¶ü‡¶æ ‡¶®‡ßá‡¶¨‡ßá, Ananna?</h2>
                        <p class="mb-4">‡¶Ü‡¶Æ‡¶ø ‡¶ú‡¶æ‡¶®‡¶ø ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡•§ ‡¶ö‡¶≤‡ßã, ‡¶Ü‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶ø?</p>
                        <button id="start-challenge-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 shadow-md">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶Æ‡¶ø ‡¶™‡¶æ‡¶∞‡¶¨‡ßã!</button>
                    </div>
                    <div id="active-challenge-state" class="hidden">
                        <h2 id="challenge-day-text" class="text-2xl md:text-3xl font-bold text-teal-600 mb-4"></h2>
                        <div class="w-full bg-gray-200 rounded-full h-4 mb-6"><div id="progress-bar" class="bg-teal-500 h-4 rounded-full"></div></div>
                        <label for="bite-count" class="block text-lg font-medium mb-2">‡¶Ü‡¶ú ‡¶ï‡¶§‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶∑‡ßç‡¶ü ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßã ‡¶†‡ßã‡¶Å‡¶ü ‡¶¶‡ßÅ‡¶ü‡ßã‡¶ï‡ßá?</label>
                        <input type="number" id="bite-count" min="0" class="w-full max-w-xs mx-auto p-3 border border-gray-300 rounded-lg text-center text-lg focus:ring-2 focus:ring-teal-500" placeholder="‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                        <button id="log-today-btn" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶æ‡¶ì</button>
                        <p id="log-feedback" class="mt-2 text-sm text-green-600 h-4"></p>
                    </div>
                </section>

                <section id="history-section" class="card p-6 rounded-2xl shadow-lg hidden">
                    <h3 class="text-xl font-bold mb-4 text-center">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶ï‡ßç‡¶∑‡ßÄ</h3>
                    <div id="log-history" class="space-y-3 max-h-60 overflow-y-auto pr-2"></div>
                </section>

                <section class="card p-6 rounded-2xl shadow-lg">
                    <h3 class="text-2xl font-bold mb-4 text-center text-rose-500">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßã</h3>
                    <p class="text-center text-gray-600 mb-4">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø, ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßá ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ü¶Å-‡¶ï‡ßá ‡¶™‡¶æ‡¶†‡¶ø‡ßü‡ßá ‡¶¶‡¶æ‡¶ì‡•§</p>
                    <textarea id="share-code-output" readonly class="w-full h-32 p-2 border rounded bg-gray-100 text-xs" placeholder="‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡ßã‡¶° ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶¨‡ßá..."></textarea>
                    <button id="copy-code-btn" class="mt-2 bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2 px-4 rounded-lg text-sm">‡¶ï‡ßã‡¶° ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßã</button>
                </section>
            </div>

            <!-- Observer View -->
            <div id="observer-view" class="hidden space-y-8">
                 <header class="text-center">
                    <h1 class="text-3xl md:text-4xl font-bold text-rose-600">‡¶Ü‡¶Æ‡¶æ‡¶∞ Doraemon-‡¶è‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ü¶Å</h1>
                 </header>

                <section id="observer-input-section" class="card p-6 rounded-2xl shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 text-center">‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø ‡¶¶‡ßá‡¶ñ‡¶§‡ßá, ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßã</h2>
                    <textarea id="observer-code-input" class="w-full h-32 p-2 border rounded bg-gray-50" placeholder="Ananna-‡¶∞ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßã..."></textarea>
                    <button id="view-report-btn" class="mt-4 w-full bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg">‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡ßã</button>
                    <p id="observer-error" class="text-center text-red-500 mt-2 h-4"></p>
                </section>

                <div id="observer-report-view" class="hidden space-y-8">
                    <section class="card p-6 rounded-2xl shadow-lg text-center">
                        <h2 id="observer-challenge-day-text" class="text-2xl md:text-3xl font-bold text-teal-600 mb-4"></h2>
                        <div class="w-full bg-gray-200 rounded-full h-4"><div id="observer-progress-bar" class="bg-teal-500 h-4 rounded-full"></div></div>
                    </section>
                    <section class="card p-6 rounded-2xl shadow-lg">
                        <h3 class="text-xl font-bold mb-4 text-center">‡¶§‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶°</h3>
                        <div id="observer-log-history" class="space-y-3 max-h-60 overflow-y-auto pr-2"></div>
                    </section>
                </div>
            </div>
            
            <!-- Common Sections -->
            <div class="space-y-8 mt-8">
                 <section class="card p-6 rounded-2xl shadow-lg">
                    <h3 class="text-2xl font-bold mb-4 text-center text-rose-500">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶†‡ßã‡¶Å‡¶ü‡ßá‡¶∞ ‡¶Ø‡¶§‡ßç‡¶® ‡¶®‡¶æ‡¶ì, Doraemon</h3>
                    <p class="text-center text-gray-700 leading-relaxed">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶æ‡¶∏‡¶ø‡¶ü‡¶æ ‡¶Ø‡ßá‡¶Æ‡¶® ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞, ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶†‡ßã‡¶Å‡¶ü ‡¶¶‡ßÅ‡¶ü‡ßã‡¶ì ‡¶†‡¶ø‡¶ï ‡¶§‡ßá‡¶Æ‡¶®‡¶á ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡•§ ‡¶è‡¶á ‡¶†‡ßã‡¶Å‡¶ü ‡¶¶‡ßÅ‡¶ü‡ßã ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶á ‡¶ï‡¶æ‡¶Æ‡ßú‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡ßü‡•§ ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Ø‡¶§‡ßç‡¶® ‡¶®‡¶ø‡¶≤‡ßá‡¶á ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá, ‡¶ì‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶∞‡¶ì ‡¶ï‡¶§ ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶Ü‡¶∞ ‡¶®‡¶∞‡¶Æ ‡¶π‡ßü‡ßá ‡¶â‡¶†‡¶¨‡ßá‡•§ ‡¶∏‡¶¨‡¶∏‡¶Æ‡ßü ‡¶≤‡¶ø‡¶™ ‡¶¨‡¶æ‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá, ‡¶Ü‡¶∞ ‡¶™‡ßç‡¶∞‡¶ö‡ßÅ‡¶∞ ‡¶™‡¶æ‡¶®‡¶ø ‡¶ñ‡¶æ‡¶¨‡ßá, ‡¶ï‡ßá‡¶Æ‡¶®?</p>
                </section>

                <section class="card p-6 rounded-2xl shadow-lg">
                     <h3 class="text-xl font-bold mb-4 text-gray-900 text-center">‡¶ï‡ßá‡¶® ‡¶†‡ßã‡¶Å‡¶ü‡¶ï‡ßá ‡¶ï‡¶∑‡ßç‡¶ü ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶â‡¶ö‡¶ø‡¶§ ‡¶®‡ßü</h3>
                    <div class="grid md:grid-cols-2 gap-6 text-left">
                        <div>
                            <h4 class="font-semibold text-lg mb-2 text-rose-700">‡¶§‡¶æ‡ßé‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:</h4>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>‡¶¨‡ßç‡¶Ø‡¶•‡¶æ ‡¶π‡¶ì‡ßü‡¶æ, ‡¶´‡ßÅ‡¶≤‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶¨‡¶æ ‡¶∞‡¶ï‡ßç‡¶§ ‡¶¨‡ßá‡¶∞ ‡¶π‡¶ì‡ßü‡¶æ‡•§</li>
                                <li>‡¶†‡ßã‡¶Å‡¶ü‡ßá‡¶∞ ‡¶ö‡¶æ‡¶Æ‡ßú‡¶æ ‡¶â‡¶†‡ßá ‡¶∞‡ßÅ‡¶ï‡ßç‡¶∑ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ‡•§</li>
                                <li>‡¶ï‡ßç‡¶∑‡¶§‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá ‡¶ú‡ßÄ‡¶¨‡¶æ‡¶£‡ßÅ ‡¶¢‡ßÅ‡¶ï‡ßá ‡¶á‡¶®‡¶´‡ßá‡¶ï‡¶∂‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg mb-2 text-rose-700">‡¶¶‡ßÄ‡¶∞‡ßç‡¶ò‡¶Æ‡ßá‡ßü‡¶æ‡¶¶‡ßÄ ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø:</h4>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>‡¶†‡ßã‡¶Å‡¶ü‡ßá ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ ‡¶¶‡¶æ‡¶ó ‡¶¨‡¶æ ‡¶ï‡¶æ‡¶≤‡ßã ‡¶õ‡ßã‡¶™ ‡¶™‡ßú‡ßá ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
                                <li>‡¶†‡ßã‡¶Å‡¶ü‡ßá‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶¨‡¶ø‡¶ï ‡¶Ü‡¶ï‡ßÉ‡¶§‡¶ø ‡¶®‡¶∑‡ßç‡¶ü ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
                                <li>‡¶ñ‡ßÅ‡¶¨ ‡¶¨‡¶ø‡¶∞‡¶≤ ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞‡ßá, ‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶¨‡¶õ‡¶∞ ‡¶ß‡¶∞‡ßá ‡¶ö‡¶≤‡¶§‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶ï‡ßç‡¶∑‡¶§ ‡¶Ø‡¶¶‡¶ø ‡¶®‡¶æ ‡¶∏‡¶æ‡¶∞‡ßá, ‡¶§‡¶¨‡ßá ‡¶§‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶ì‡¶∞‡¶æ‡¶≤ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶≠‡ßü‡¶æ‡¶¨‡¶π ‡¶∞‡ßã‡¶ó‡ßá‡¶∞ ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø‡¶ì ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
                            </ul>
                        </div>
                    </div>
                     <p class="text-center mt-6 text-gray-600">‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶≠‡ßü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶ö‡¶æ‡¶á ‡¶®‡¶æ, ‡¶¨‡¶â‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ö‡¶æ‡¶á ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶∏‡ßÅ‡¶∏‡ßç‡¶• ‡¶•‡¶æ‡¶ï‡ßã, ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶•‡¶æ‡¶ï‡ßã‡•§ ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßç‡¶∑‡¶§‡¶ø ‡¶π‡ßã‡¶ï, ‡¶§‡¶æ ‡¶Ü‡¶Æ‡¶ø ‡¶ö‡¶æ‡¶á ‡¶®‡¶æ‡•§</p>
                </section>
            </div>
            <footer class="text-center mt-12 text-gray-600">
                <p>‡¶∏‡¶¨‡¶∏‡¶Æ‡ßü ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∂‡ßá ‡¶Ü‡¶õ‡¶ø, ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ü¶Å</p>
            </footer>
        </div>
    </div>

    <script>
        // DOM Elements
        const pinScreen = document.getElementById('pin-screen');
        const mainContent = document.getElementById('main-content');
        const pinInput = document.getElementById('pin-input');
        const enterBtn = document.getElementById('enter-btn');
        const pinError = document.getElementById('pin-error');
        
        const userView = document.getElementById('user-view');
        const observerView = document.getElementById('observer-view');
        
        // User View Elements
        const startState = document.getElementById('start-state');
        const startChallengeBtn = document.getElementById('start-challenge-btn');
        const activeChallengeState = document.getElementById('active-challenge-state');
        const challengeDayText = document.getElementById('challenge-day-text');
        const progressBar = document.getElementById('progress-bar');
        const biteCountInput = document.getElementById('bite-count');
        const logTodayBtn = document.getElementById('log-today-btn');
        const logFeedback = document.getElementById('log-feedback');
        const historySection = document.getElementById('history-section');
        const logHistory = document.getElementById('log-history');
        const shareCodeOutput = document.getElementById('share-code-output');
        const copyCodeBtn = document.getElementById('copy-code-btn');

        // Observer View Elements
        const observerInputSection = document.getElementById('observer-input-section');
        const observerCodeInput = document.getElementById('observer-code-input');
        const viewReportBtn = document.getElementById('view-report-btn');
        const observerError = document.getElementById('observer-error');
        const observerReportView = document.getElementById('observer-report-view');
        const observerChallengeDayText = document.getElementById('observer-challenge-day-text');
        const observerProgressBar = document.getElementById('observer-progress-bar');
        const observerLogHistory = document.getElementById('observer-log-history');

        const DB_KEY = 'anannaChallengeData_v3'; // Using a new key to avoid conflict

        // --- Utility Functions ---
        const getTodayDateString = () => new Date().toISOString().split('T')[0];

        // --- Data Functions ---
        function getChallengeData() {
            const data = localStorage.getItem(DB_KEY);
            return data ? JSON.parse(data) : { startDate: null, logs: {} };
        }

        function saveChallengeData(data) {
            localStorage.setItem(DB_KEY, JSON.stringify(data));
        }

        // --- PIN Logic ---
        enterBtn.addEventListener('click', () => {
            const pin = pinInput.value;
            if (pin === '16') {
                pinScreen.classList.add('hidden');
                mainContent.classList.remove('hidden');
                setupUserView();
            } else if (pin === '1616') {
                pinScreen.classList.add('hidden');
                mainContent.classList.remove('hidden');
                setupObserverView();
            } else {
                pinError.textContent = '‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶®‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßã‡•§';
            }
        });
        pinInput.addEventListener('keyup', (e) => e.key === 'Enter' && enterBtn.click());
        
        // --- View Setup ---
        function setupUserView() {
            userView.classList.remove('hidden');
            observerView.classList.add('hidden');
            const data = getChallengeData();
            renderUserUI(data);
            updateShareCode();
        }

        function setupObserverView() {
            userView.classList.add('hidden');
            observerView.classList.remove('hidden');
        }

        // --- User UI Logic ---
        function renderUserUI(data) {
            if (data.startDate) {
                startState.classList.add('hidden');
                activeChallengeState.classList.remove('hidden');
                historySection.classList.remove('hidden');
                
                const startDate = new Date(data.startDate);
                const now = new Date();
                const diffTime = Math.abs(now - startDate);
                const currentDay = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
                const displayDay = Math.min(currentDay, 30);
                const progressPercentage = (displayDay / 30) * 100;

                challengeDayText.textContent = `‡¶¶‡¶ø‡¶®: ${displayDay}/‡ß©‡ß¶`;
                progressBar.style.width = `${progressPercentage}%`;

                const todayStr = getTodayDateString();
                biteCountInput.value = data.logs[todayStr] || '';
                renderLogHistory(data.logs, logHistory);

            } else {
                startState.classList.remove('hidden');
                activeChallengeState.classList.add('hidden');
                historySection.classList.add('hidden');
            }
        }

        function renderLogHistory(logs, container) {
            container.innerHTML = '';
            const sortedDates = Object.keys(logs).sort((a, b) => new Date(b) - new Date(a));

            if (sortedDates.length === 0) {
                container.innerHTML = '<p class="text-center text-gray-500">‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§</p>';
                return;
            }

            sortedDates.forEach(dateStr => {
                const count = logs[dateStr];
                const logDate = new Date(dateStr);
                const formattedDate = logDate.toLocaleDateString('bn-BD', { day: 'numeric', month: 'long', year: 'numeric' });
                const logElement = document.createElement('div');
                logElement.className = 'flex justify-between items-center bg-gray-100 p-3 rounded-lg';
                logElement.innerHTML = `
                    <span class="font-medium">${formattedDate}</span>
                    <span class="font-bold text-teal-600">${count} ‡¶¨‡¶æ‡¶∞</span>
                `;
                container.appendChild(logElement);
            });
        }

        function updateShareCode() {
            const data = getChallengeData();
            const jsonString = JSON.stringify(data);
            const encodedData = btoa(jsonString); // Using Base64 for robustness
            shareCodeOutput.value = encodedData;
        }

        startChallengeBtn.addEventListener('click', () => {
            const data = getChallengeData();
            data.startDate = new Date().toISOString();
            saveChallengeData(data);
            renderUserUI(data);
            updateShareCode();
        });

        logTodayBtn.addEventListener('click', () => {
            const count = biteCountInput.value;
            if (count === '' || isNaN(count) || count < 0) {
                logFeedback.textContent = '‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¶‡¶æ‡¶ì‡•§';
                logFeedback.classList.add('text-red-500');
                return;
            }
            const data = getChallengeData();
            data.logs[getTodayDateString()] = parseInt(count, 10);
            saveChallengeData(data);
            logFeedback.textContent = `‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° (${count} ‡¶¨‡¶æ‡¶∞) ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶ñ‡ßÅ‡¶¨ ‡¶ñ‡ßÅ‡¶∂‡¶ø!`;
            logFeedback.classList.remove('text-red-500');
            renderLogHistory(data.logs, logHistory);
            updateShareCode();
            setTimeout(() => { logFeedback.textContent = ''; }, 3000);
        });
        
        copyCodeBtn.addEventListener('click', () => {
            if (!shareCodeOutput.value) {
                alert("‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßã‡¶° ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡ßü‡¶®‡¶ø‡•§");
                return;
            }
            shareCodeOutput.select();
            document.execCommand('copy');
            copyCodeBtn.textContent = "‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá!";
            setTimeout(() => { copyCodeBtn.textContent = "‡¶ï‡ßã‡¶° ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡ßã"; }, 2000);
        });

        // --- Observer UI Logic ---
        viewReportBtn.addEventListener('click', () => {
            const encodedData = observerCodeInput.value.trim();
            if (!encodedData) {
                observerError.textContent = '‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶ï‡ßã‡¶° ‡¶™‡ßá‡¶∏‡ßç‡¶ü ‡¶ï‡¶∞‡ßã‡•§';
                return;
            }
            try {
                const jsonString = atob(encodedData); // Using Base64 for robustness
                const data = JSON.parse(jsonString);

                if (typeof data.startDate === 'undefined' || typeof data.logs === 'undefined') {
                    throw new Error("Invalid data format");
                }

                observerError.textContent = '';
                observerInputSection.classList.add('hidden');
                observerReportView.classList.remove('hidden');
                renderObserverReport(data);

            } catch (e) {
                console.error(e);
                observerError.textContent = '‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü‡•§ ‡¶™‡ßÅ‡¶∞‡ßã‡¶ü‡¶æ ‡¶ï‡¶™‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶ï‡¶ø?';
            }
        });

        function renderObserverReport(data) {
            if (!data.startDate) {
                observerReportView.innerHTML = '<p class="text-center text-gray-700">‡¶∏‡ßá ‡¶è‡¶ñ‡¶®‡¶ì ‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßá‡¶®‡¶ø‡•§</p>';
                return;
            }
            const startDate = new Date(data.startDate);
            const now = new Date();
            const diffTime = Math.abs(now - startDate);
            const currentDay = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
            const displayDay = Math.min(currentDay, 30);
            const progressPercentage = (displayDay / 30) * 100;

            observerChallengeDayText.textContent = `‡¶¶‡¶ø‡¶®: ${displayDay}/‡ß©‡ß¶`;
            observerProgressBar.style.width = `${progressPercentage}%`;
            
            renderLogHistory(data.logs, observerLogHistory);
        }

    </script>
</body>
</html>
